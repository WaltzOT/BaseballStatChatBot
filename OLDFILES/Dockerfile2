FROM python:3.8

# Install CPU-only PyTorch
RUN pip install torch==2.1.0 --index-url https://download.pytorch.org/whl/cpu

# Install compatible NeMo version for NLP (avoiding Megatron)
RUN pip install nemo-toolkit[all]==1.20.0 --no-cache-dir \
    && pip install pydantic==1.10.12 --force-reinstall

# Set working directory
WORKDIR /workspace

# Copy project files
COPY ./data /workspace/data
COPY ./scripts /workspace/scripts
COPY ./models /workspace/models

# Set output model folder
ENV MODEL_DIR=/workspace/models

# Default command to run
CMD ["python", "scripts/initialTraining.py"]